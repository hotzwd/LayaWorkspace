var GameScene=function(e){function t(){this.Init()}Laya.class(t,"Core.GameScene",void 0),_proto=t.prototype;return _proto.gameUI=null,_proto.gameLayer=null,_proto.gameScore=0,_proto.startTime=0,_proto.gameTime=0,_proto.leftGameTime=0,_proto.lineGraphics=null,_proto.snowBall=null,_proto.snowBallPoint=null,_proto.snowBallDir=1,_proto.snowBallSpeed=1,_proto.treeLayerSpeed=1,_proto.isGameover=!1,_proto.treeList=[],_proto.treeLayerDis=0,_proto.pointList=[],_proto.Init=function(){void 0==this.gameUI&&(this.gameUI=UIManager.getInstance().showUI("GameUI")),MusicManager.getInstance().playMusic("res/music/1.mp3"),this.gameLayer=this.gameUI.gameLayer,this.treeLayer=this.gameUI.treeLayer,this.lineGraphics=this.gameUI.g_trajectory.graphics,this.snowBall=this.gameUI.img_ball,this.snowBallPoint=new Point(this.snowBall.x,this.snowBall.y),TreeGenerator.getInstance().initGenerator(this.treeLayer),this.gameLayer.on(Laya.Event.CLICK,this,this._clickLayerEvent),this.restartGame(!0)},_proto.onDestroy=function(){},_proto.delayInitShow=function(){},_proto.startGame=function(){Laya.timer.frameLoop(1,this,this.onUpdate),Laya.timer.loop(1e3,this,this.updateGameTime)},_proto.pauseGame=function(){Laya.timer.clear(this,this.onUpdate),Laya.timer.clear(this,this.updateGameTime)},_proto.resumeGame=function(){Laya.timer.frameLoop(1,this,this.onUpdate),Laya.timer.loop(1e3,this,this.updateGameTime)},_proto.restartGame=function(e,t){this.snowBallDir=1,this.snowBallSpeed=3,this.treeLayerSpeed=6,this.gameScore=e?0:t,this.gameUI.t_gamescore.text=this.gameScore,this.isGameover=!1,this.snowBall.pos(this.snowBallPoint.x,this.snowBallPoint.y),this.snowBall.visible=!0,this.treeLayerDis=0,this.treeLayer.pos(0,0),this.lineGraphics.clear(),this.pointList=[];for(var a=0;a<this.treeList.length;a++){var i=this.treeList[a];TreeFactory.getInstance().recoveryObgectToPool(i),this.treeList.splice(a,1)}this.treeList=[],this.createTreeList(0)},_proto.gameover=function(e){if(this.snowBallDead(),Laya.timer.clear(this,this.onUpdate),Laya.timer.clear(this,this.updateGameTime),this.isGameover=!0,Browser.onMiniGame){if(null==wxGame.getInstance().videoAd||!window.wxLoadVideoAd)return void UIManager.getInstance().showUI("GameOverUI");UIManager.getInstance().showUI("GameSharedUI")}else UIManager.getInstance().showUI("GameSharedUI")},_proto.snowBallDead=function(){MusicManager.getInstance().playSound("res/music/gameover.wav"),this.snowBall.visible=!1,this.lineGraphics.clear();var e=new Point(0,0);this.snowBall.localToGlobal(e);var t=new Laya.Image("Game/blanco.png");t.anchorX=.5,t.anchorY=.5,t.pos(e.x,e.y),Laya.stage.addChild(t),t.alpha=0,t.scaleX=0,t.scaleY=0;var a=new Laya.TimeLine;a.addLabel("show",0).to(t,{alpha:1,scaleX:1.5,scaleY:1.5},300).addLabel("go",0).to(t,{alpha:0},500),a.play(0,!1),a.on(Laya.Event.COMPLETE,this,function(e){e.destroy()},[t])},_proto.onUpdate=function(){if(!this.isGameover){if(this.treeLayer.y-=this.treeLayerSpeed,this.treeLayerDis+=this.treeLayerSpeed,this.treeLayerDis>=this.treeLayerCreateDis){var e=new Point(0,Laya.stage.height+10);this.treeLayer.globalToLocal(e),this.createTreeList(e.y)}for(var t=0;t<this.pointList.length;t++){var a=this.pointList[t];this.treeLayer.localToGlobal(a,!0).y-this.treeLayerDis<-200&&this.pointList.splice(t,1)}this.updateBall(),this.updateTreeList()}},_proto.updateBall=function(){this.snowBall.x+=this.snowBallSpeed*this.snowBallDir;var e=new Point(0,0);this.snowBall.localToGlobal(e),(e.x<=0||e.x>=Laya.stage.width-20)&&(Gamelog("-----撞到边界"),this.gameover()),this.treeLayer.globalToLocal(e),this.pointList.push(e),this.lineGraphics.clear();for(var t=[],a=0;a<this.pointList.length;a++){var i=this.pointList[a];t.push(i.x),t.push(i.y)}this.drawLines(t)},_proto.drawLines=function(e){this.lineGraphics.save(),this.lineGraphics.drawLines(10,8,e,"#dddbdb",10)},_proto.drawLine=function(e){this.lineGraphics.save(),this.lineGraphics.drawCircle(e.x+10,e.y,8,"#dddbdb")},_proto.createTreeList=function(e){if(0==e){s=TreeGenerator.getInstance().createTree(6);this.treeList=this.treeList.concat(s);for(var t=0;t<6;t++){var a=this.treeLayer.getChildByName("tree"+(t+1));this.treeList[t].pos(a.x,a.y)}}else{var i=parseInt(2*Math.random()+1),s=TreeGenerator.getInstance().createTree(i,e);this.treeList=this.treeList.concat(s)}this.treeLayerCreateDis=20*parseInt(Math.random()*this.treeLayerSpeed+this.treeLayerSpeed),this.treeLayerDis=0},_proto.updateTreeList=function(){for(var e=0;e<this.treeList.length;e++){var t=this.treeList[e],a=new Point(0,0);t.localToGlobal(a);var i=new Point(0,0);this.snowBall.localToGlobal(i),this.treeLayer.globalToLocal(i),t.hitTree(i)&&(Gamelog("-----撞到树"),this.gameover()),t.nearTree(i)&&this.showScore(a),a.y<-50&&(TreeFactory.getInstance().recoveryObgectToPool(t),this.treeList.splice(e,1))}},_proto.showScore=function(e){var t=parseInt(2*Math.random()+1);MusicManager.getInstance().playSound("res/music/score"+t+".wav");this.addGameScore(10);var a=new Laya.Label("+10");a.font="SimHei",a.fontSize=45,a.bold=!0,a.color="#000000",a.align="center",a.pos(e.x,e.y),Laya.stage.addChild(a),a.alpha=0,a.scaleX=0,a.scaleY=0,a.zOrder=5;var i=new Laya.TimeLine;i.addLabel("show",0).to(a,{alpha:1,scaleX:1,scaleY:1},200).addLabel("go",0).to(a,{y:e.y-200,alpha:0},500),i.play(0,!1),i.on(Laya.Event.COMPLETE,this,function(e){e.destroy()},[a])},_proto.addGameScore=function(e){this.gameScore+=e,this.gameUI.t_gamescore.text=this.gameScore},_proto.updateGameTime=function(){this.addGameScore(1)},_proto.addLife=function(e){this.resumeGame(),e&&(this.gameTime+=11),wxGame.getInstance().createVideoAD()},_proto._clickLayerEvent=function(){if(MusicManager.getInstance().playSound("res/music/snow.wav"),1==this.snowBallDir)for(var e=(this.snowBallDir+1)/.1,t=0;t<e;t++)Laya.timer.frameOnce(t,this,function(){this.snowBallDir-=.1,this.snowBallDir<=-1&&(this.snowBallDir=-1)});else for(var e=(1-this.snowBallDir)/.1,t=0;t<e;t++)Laya.timer.frameOnce(t,this,function(){this.snowBallDir+=.1,this.snowBallDir>=1&&(this.snowBallDir=1)})},t}();